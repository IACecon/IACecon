<div id="modal-form-usuarios" class="cecon-modal-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:9999; justify-content:center; align-items:center;">
  <div class="modal-box-grande" style="background:white; padding:20px; border-radius:8px; width:90%; max-width:800px; color: #333;">
    <h5 id="modal-usuarios-titulo" style="color: #2196f3; margin-top: 0;">gestión de usuario</h5>
    <form id="form-usuarios-logic">
      <div class="row">
        <div class="input-field col s12 m6"><input id="u_nombre" type="text" required><label class="active" for="u_nombre">nombre y apellidos</label></div>
        <div class="input-field col s12 m6"><input id="u_mail" type="email" required><label class="active" for="u_mail">mail</label></div>
        <div class="input-field col s12 m6"><input id="u_tel" type="text"><label class="active" for="u_tel">teléfono</label></div>
        <div class="input-field col s12 m6">
          <select id="u_rol" class="browser-default" style="display:block">
            <option value="Vigilante">Vigilante</option>
            <option value="Jefe de Equipo">Jefe de Equipo</option>
            <option value="Director/Jefe de Seguridad">Director/Jefe de Seguridad</option>
            <option value="Gerencia">Gerencia</option>
          </select>
        </div>
      </div>
      <div style="text-align: right; margin-top: 20px;">
        <button type="button" class="btn red" onclick="document.getElementById('modal-form-usuarios').style.display='none'" style="margin-right:10px;">cancelar</button>
        <button type="submit" class="btn green">guardar</button>
      </div>
    </form>
  </div>
</div>

<script>
  document.getElementById('form-usuarios-logic').onsubmit = function(e) {
    e.preventDefault();
    const data = {
      nombre: document.getElementById('u_nombre').value,
      mail: document.getElementById('u_mail').value,
      tel: document.getElementById('u_tel').value,
      rol: document.getElementById('u_rol').value
    };
    const acc = document.getElementById('u_nombre').disabled ? "modificar" : "alta";
    
    registrarLog("enviando_datos", "Gestión de Usuarios", data);
    
    google.script.run
      .withSuccessHandler(res => {
        document.getElementById('modal-form-usuarios').style.display = 'none';
        registrarLog("exito_guardado", "Gestión de Usuarios", res);
        cargarSeccion("Gestión de Usuarios");
      })
      .api_usuarios_ejecutar_accion(window.currentData.archivo_id, acc, data);
  };
</script>